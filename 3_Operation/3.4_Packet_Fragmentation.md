# 3.4 Packet Fragmentation

When an RTMFP packet (Section [2.2.4][1]) is unavoidably larger than the
   path MTU (such as a startup packet containing an RHello
   (Section [2.3.4][2]) or IIKeying (Section [2.3.7][3]) chunk with a large
   certificate), it can be fragmented into segments that do not exceed
   the path MTU using the Packet Fragment chunk (Section [2.3.1][4]).

   The packet fragmentation mechanism SHOULD ONLY be used to segment
   unavoidably large packets.  Accordingly, this mechanism SHOULD ONLY
   be employed during session startup with session ID 0.  This mechanism
   MUST NOT be used instead of the natural fragmentation mechanism of
   the User Data (Section [2.3.11][5]) and Next User Data (Section [2.3.12][6])
   chunks for dividing the messages of the user's data flows into
   segments that do not exceed the path MTU.

   A fragmented plain RTMFP packet is reassembled by concatenating the
   packetFragment fields of the fragments for the packet in contiguous
   ascending order, starting from index 0 through and including the
   final fragment.
   
   When reassembling packets for Session ID 0, a receiver SHOULD
   identify the packets by both the socket address from which the packet
   containing the fragment was received as well as the indicated
   packetID.
   
   A receiver SHOULD allow up to 60 seconds to completely receive a
   fragmented packet for which progress is being made.  A packet is
   progressing if at least one new fragment for it was received in the
   last second.
   
   A receiver MUST discard a Packet Fragment chunk having an empty
   packetFragment field.
   
   The mode of each packet containing Packet Fragments for the same
   fragmented packet MUST match the mode of the fragmented packet.  A
   receiver MUST discard any new Packet Fragment chunk received in a
   packet with a mode different from the mode of the packet containing
   the first received fragment.  A receiver MUST discard any reassembled
   packet with a mode different than the packets containing its
   fragments.
   
   In order to avoid jamming the network, the sender MUST rate limit
   packet transmission.  In the absence of specific path capacity
   information (for instance, during session startup), a sender SHOULD
   NOT send more than 4380 bytes nor more than four packets per distinct
   endpoint every 200ms.
   
   To avoid resource exhaustion, a receiver SHOULD limit the number of
   concurrent packet reassembly buffers and the size of each buffer.


[1]:    ../2_Syntax/2.2.4_Packet.md
[2]:    ../2_Syntax/2.3.4_Responder_Hello_Chunk.md
[3]:    ../2_Syntax/2.3.7_Initiator_Initial_Keying_Chunk.md
[4]:    ../2_Syntax/2.3.1_Packet_Fragment_Chunk.md
[5]:    ../2_Syntax/2.3.11_User_Data_Chunk.md
[6]:    ../2_Syntax/2.3.12_Next_User_Data_Chunk.md
